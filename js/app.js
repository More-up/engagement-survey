// API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
const API_ENDPOINT = 'https://engagement-survey-api.more-up.workers.dev';

// 10ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®å®šç¾©
const categories = [
    "å¿ƒèº«ã®å¥åº·",
    "ä»•äº‹ã®å……å®Ÿæ„Ÿ",
    "æˆé•·æ©Ÿä¼š",
    "ä¸Šå¸ã®ã‚µãƒãƒ¼ãƒˆ",
    "éƒ¨ç½²å†…ã®äººé–“é–¢ä¿‚",
    "è©•ä¾¡ãƒ»å‡¦é‡",
    "ä¼šç¤¾ã¸ã®ä¿¡é ¼",
    "åƒãç’°å¢ƒ",
    "ç·åˆæº€è¶³åº¦",
    "çµ„ç¹”ã¸ã®ã¤ãªãŒã‚Š"
];

// 100å•ã®è³ªå•(å„ã‚«ãƒ†ã‚´ãƒªãƒ¼10å•)
const questions = [
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼1: å¿ƒèº«ã®å¥åº· (Q1-10)
    "åƒããªãŒã‚‰ã‚‚ã€å¿ƒèº«ã®å¥åº·ã‚’ä¿ã¦ã¦ã„ã‚‹ã¨æ„Ÿã˜ã‚‹",
    "ä»•äº‹ã®ã‚¹ãƒˆãƒ¬ã‚¹ã‚’ã†ã¾ãç®¡ç†ã§ãã¦ã„ã‚‹",
    "ä»•äº‹ãŒåŸå› ã§ç¡çœ ä¸è¶³ã«ãªã‚‹ã“ã¨ã¯ãªã„",
    "ä»•äº‹ã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã®æ™‚é–“é…åˆ†ã«æº€è¶³ã—ã¦ã„ã‚‹",
    "å¿…è¦ãªæ™‚ã«ä¼‘æš‡ã‚’å–å¾—ã§ãã¦ã„ã‚‹",
    "ä¼‘ã¿ã®æ—¥ã¯ä»•äº‹ã®ç–²ã‚Œã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã§ãã¦ã„ã‚‹",
    "è·å ´ã§æ‚©ã¿ã‚„è‹¦ã—ã¿ã‚’ç›¸è«‡ã§ãã‚‹äººãŒã„ã‚‹",
    "å¤±æ•—ã‚„è‹¦æ‰‹ãªã“ã¨ã‚’æã‚Œãšä¸Šå¸ã‚„åŒåƒšã«ç›¸è«‡ã§ãã‚‹",
    "ä»•äº‹ã®è² è·ãŒåŸå› ã§ã€ä½“èª¿ã‚’å´©ã™ã“ã¨ãŒã‚ã‚‹",
    "è‡ªåˆ†ã®ä¾¡å€¤è¦³ã‚„è€ƒãˆæ–¹ãŒè·å ´ã§å—ã‘å…¥ã‚Œã‚‰ã‚Œã¦ã„ã‚‹",
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼2: ä»•äº‹ã®å……å®Ÿæ„Ÿ (Q11-20)
    "ä»Šã®ä»•äº‹ã«ã‚„ã‚ŠãŒã„ã‚’æ„Ÿã˜ã¦ã„ã‚‹",
    "è‡ªåˆ†ã®ä»•äº‹ãŒä¼šç¤¾ã®ç›®æ¨™é”æˆã«è²¢çŒ®ã—ã¦ã„ã‚‹ã¨æ„Ÿã˜ã‚‹",
    "ä»•äº‹ã‚’å®Œäº†ã—ãŸæ™‚ã«é”æˆæ„Ÿã‚’æ„Ÿã˜ã¦ã„ã‚‹",
    "è‡ªåˆ†ã®å¼·ã¿ã‚’æ´»ã‹ã—ã¦ä»•äº‹ãŒã§ãã¦ã„ã‚‹",
    "æ‹…å½“æ¥­å‹™ã®å†…å®¹ã«èˆˆå‘³ã‚’æŒã£ã¦å–ã‚Šçµ„ã‚“ã§ã„ã‚‹",
    "æ‹…å½“ã—ã¦ã„ã‚‹æ¥­å‹™ã®ç›®çš„ã‚„æ„ç¾©ã‚’ç†è§£ã—ã¦ã„ã‚‹",
    "è‡ªåˆ†ã®åˆ¤æ–­ã§æ¥­å‹™ã‚’é€²ã‚ã‚‰ã‚Œã‚‹ç’°å¢ƒãŒã‚ã‚‹",
    "æ‹…å½“æ¥­å‹™ã®ç¯„å›²ã‚„è²¬ä»»ãŒæ˜ç¢ºã§ã‚ã‚‹",
    "ä»•äº‹ã®é€²ã‚æ–¹ã«ã¤ã„ã¦ã€è‡ªåˆ†ãªã‚Šã®å·¥å¤«ã‚„æ”¹å–„ãŒã§ãã¦ã„ã‚‹",
    "è‡ªåˆ†ã®ä»•äº‹ãŒç¤¾ä¼šã‚„é¡§å®¢ã«å½¹ç«‹ã£ã¦ã„ã‚‹ã¨æ„Ÿã˜ã¦ã„ã‚‹",
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼3: æˆé•·æ©Ÿä¼š (Q21-30)
    "ã“ã®1å¹´ã§ã€è‡ªåˆ†ã®ã‚¹ã‚­ãƒ«ã‚„çŸ¥è­˜ãŒæˆé•·ã—ãŸã¨æ„Ÿã˜ã‚‹",
    "æ¥­å‹™ã«å½¹ç«‹ã¤ç ”ä¿®ã‚„å‹‰å¼·ä¼šã«å‚åŠ ã§ãã¦ã„ã‚‹",
    "æ¥­å‹™æ™‚é–“å†…ã«å­¦ç¿’ã‚„ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã®æ™‚é–“ã‚’ç¢ºä¿ã§ãã¦ã„ã‚‹",
    "æ¥­å‹™ã‚’é€šã˜ã¦å®Ÿè·µçš„ãªã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ã‚‰ã‚Œã¦ã„ã‚‹",
    "ä¼šç¤¾ã¯è³‡æ ¼å–å¾—ã‚„å­¦ç¿’ã‚’æ”¯æ´ã—ã¦ãã‚Œã¦ã„ã‚‹",
    "ä¼šç¤¾ã¯ç§ãŒå°†æ¥ã©ã®ã‚ˆã†ã«æˆé•·ã§ãã‚‹ã‹ç¤ºã—ã¦ãã‚Œã¦ã„ã‚‹",
    "è‡ªåˆ†ã®å¸Œæœ›ã™ã‚‹ã‚­ãƒ£ãƒªã‚¢ã‚’ä¼šç¤¾ã§å®Ÿç¾ã§ãã‚‹ã¨æ€ã†",
    "è‡ªåˆ†ã®æˆé•·ã«ã¤ãªãŒã‚‹æ–°ã—ã„ä»•äº‹ã‚’ä»»ã•ã‚Œã¦ã„ã‚‹",
    "ä¸Šå¸ã‚„å…ˆè¼©ã‹ã‚‰æ¥­å‹™ã«ã¤ã„ã¦æ•™ãˆã¦ã‚‚ã‚‰ãˆã¦ã„ã‚‹",
    "å¤±æ•—ã‚’æã‚ŒãšæŒ‘æˆ¦ã™ã‚‹ã“ã¨ã‚’å¾ŒæŠ¼ã—ã—ã¦ãã‚Œã‚‹è·å ´ã§ã‚ã‚‹",
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼4: ä¸Šå¸ã®ã‚µãƒãƒ¼ãƒˆ (Q31-40)
    "ä¸Šå¸ã¯ç§ã®æ„è¦‹ã‚’èã„ã¦ãã‚Œã¦ã„ã‚‹",
    "ä¸Šå¸ã‹ã‚‰æ¥­å‹™æ”¹å–„ã«ã¤ãªãŒã‚‹å…·ä½“çš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å—ã‘ã¦ã„ã‚‹",
    "ä¸Šå¸ã¯ç§ã®æˆé•·ã‚’æ”¯æ´ã—ã¦ãã‚Œã¦ã„ã‚‹",
    "ä¸Šå¸ã¨ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯å††æ»‘ã§ã‚ã‚‹",
    "ä¸Šå¸ã¯å…¨å“¡ã«å…¬å¹³ã«æ¥ã—ã¦ã„ã‚‹",
    "ä¸Šå¸ã«ç›¸è«‡ã—ã‚„ã™ã„é›°å›²æ°—ãŒã‚ã‚‹",
    "ä¸Šå¸ã¯ç§ã®ä»•äº‹ã®é€²ã‚æ–¹ã«è‡ªä¸»æ€§ã‚’èªã‚ã¦ã„ã‚‹",
    "ä¸Šå¸ã¯æ¥­å‹™ã‚’å††æ»‘ã«é€²ã‚ã‚‰ã‚Œã‚‹ã‚ˆã†æ”¯æ´ã—ã¦ã„ã‚‹",
    "ä¸Šå¸ã®æŒ‡ç¤ºã¯å…·ä½“çš„ã§ç†è§£ã—ã‚„ã™ã„",
    "ä¸Šå¸ã¯ç§ã«ä»»ã›ã‚‹ä»•äº‹ã®ç¯„å›²ã¨è²¬ä»»ã‚’æ˜ç¢ºã«ç¤ºã—ã¦ã„ã‚‹",
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼5: éƒ¨ç½²å†…ã®äººé–“é–¢ä¿‚ (Q41-50)
    "è‡ªéƒ¨ç½²ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’ä¿¡é ¼ã—ã¦ã„ã‚‹",
    "è‡ªéƒ¨ç½²ã§å”åŠ›ã—ã¦ä»•äº‹ã‚’é€²ã‚ã‚‰ã‚Œã¦ã„ã‚‹",
    "è‡ªéƒ¨ç½²ã§ãŠäº’ã„ã«åŠ©ã‘åˆã†é›°å›²æ°—ãŒã‚ã‚‹",
    "è‡ªéƒ¨ç½²å†…ã§æƒ…å ±å…±æœ‰ãŒã‚¹ãƒ ãƒ¼ã‚ºã§ã‚ã‚‹",
    "è‡ªéƒ¨ç½²ã§è‡ªç”±ã«æ„è¦‹ã‚’è¿°ã¹ã‚‹é›°å›²æ°—ãŒã‚ã‚‹",
    "è‡ªéƒ¨ç½²ã¨ä»–éƒ¨ç½²ã®é€£æºãŒã‚¹ãƒ ãƒ¼ã‚ºã§ã‚ã‚‹ã¨æ„Ÿã˜ã‚‹",
    "è‡ªéƒ¨ç½²ã®ãƒ¡ãƒ³ãƒãƒ¼ã®å½¹å‰²åˆ†æ‹…ãŒæ˜ç¢ºã§ã‚ã‚‹",
    "è‡ªéƒ¨ç½²ã®ç›®æ¨™ãŒãƒ¡ãƒ³ãƒãƒ¼é–“ã§å…±æœ‰ã•ã‚Œã¦ã„ã‚‹",
    "è‡ªéƒ¨ç½²ã§æ„è¦‹ã®é•ã„ãŒã‚ã£ã¦ã‚‚å»ºè¨­çš„ã«å¯¾è©±ãŒã§ãã¦ã„ã‚‹",
    "è‡ªéƒ¨ç½²å†…ã®äººé–“é–¢ä¿‚ã¯æ¥­å‹™ã«æ”¯éšœã‚’ããŸã—ã¦ã„ãªã„",
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼6: è©•ä¾¡ãƒ»å‡¦é‡ (Q51-60)
    "äººäº‹è©•ä¾¡åŸºæº–ãŒæ˜ç¢ºã§ã‚ã‚‹",
    "äººäº‹è©•ä¾¡ã¯å…¬å¹³ã«è¡Œã‚ã‚Œã¦ã„ã‚‹",
    "äººäº‹è©•ä¾¡é¢è«‡ã§å‰å‘ããªè©±ã—åˆã„ãŒã§ãã¦ã„ã‚‹",
    "è‡ªåˆ†ã¸ã®äººäº‹è©•ä¾¡ã«ç´å¾—ã§ãã¦ã„ã‚‹",
    "çµ¦ä¸ã‚„å¾…é‡ã¯è‡ªåˆ†ã®åƒãã«è¦‹åˆã£ã¦ã„ã‚‹",
    "æˆæœã‚„åŠªåŠ›ãŒçµ¦ä¸ã®æ±ºå®šã«åæ˜ ã•ã‚Œã¦ã„ã‚‹",
    "æ˜‡é€²ãƒ»æ˜‡æ ¼ã®æ©Ÿä¼šã¯å…¬å¹³ã§ã‚ã‚‹",
    "ç¦åˆ©åšç”Ÿåˆ¶åº¦ãŒç”Ÿæ´»ã«å½¹ç«‹ã£ã¦ã„ã‚‹",
    "ä¸Šå¸ã‹ã‚‰è©•ä¾¡ã«ã¤ã„ã¦ä¸å¯§ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å—ã‘ã¦ã„ã‚‹",
    "è‡ªåˆ†ã®åŠªåŠ›ã‚„æˆæœãŒçµ„ç¹”ã«èªã‚ã‚‰ã‚Œã¦ã„ã‚‹ã¨æ„Ÿã˜ã‚‹",
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼7: ä¼šç¤¾ã¸ã®ä¿¡é ¼ (Q61-70)
    "ä¼šç¤¾ã®Missionãƒ»Visionãƒ»Valueã‚’ç†è§£ã—ã¦ã„ã‚‹",
    "ä¼šç¤¾ã®Missionãƒ»Visionãƒ»Valueã«å…±æ„Ÿã—ã¦ã„ã‚‹",
    "ä¼šç¤¾ã¯æ³•ä»¤ã‚„å€«ç†ã‚’å®ˆã£ã¦çµŒå–¶ã—ã¦ã„ã‚‹ã¨æ„Ÿã˜ã‚‹",
    "ã“ã®ä¼šç¤¾ã®æœªæ¥ã«æœŸå¾…ã§ãã‚‹",
    "çµŒå–¶å±¤ã‹ã‚‰ä¼šç¤¾æ–¹é‡ã‚„æˆ¦ç•¥ã®æƒ…å ±ãŒå®šæœŸçš„ã«å…±æœ‰ã•ã‚Œã¦ã„ã‚‹",
    "ä¼šç¤¾ã®é‡è¦ãªæ±ºå®šã®èƒŒæ™¯ã‚„ç†ç”±ã¨ã€è‡ªéƒ¨ç½²ã¸ã®å½±éŸ¿ã‚’ç†è§£ã—ã¦ã„ã‚‹",
    "ä¼šç¤¾ã¯ã€é‡è¦ãªæ±ºå®šã®èƒŒæ™¯ã‚„ç†ç”±ã¨ã€è‡ªéƒ¨ç½²ã¸ã®å½±éŸ¿ã‚’æ˜ç¢ºã«èª¬æ˜ã—ã¦ã„ã‚‹",
    "ä¼šç¤¾ã®ä»•äº‹ãŒç¤¾ä¼šã«å½¹ç«‹ã£ã¦ã„ã‚‹ã¨æ„Ÿã˜ã¦ã„ã‚‹",
    "ä¼šç¤¾ã¯å¾“æ¥­å“¡ã®æ„è¦‹ã‚’èãä½“åˆ¶ãŒã‚ã‚‹",
    "ä¼šç¤¾ã®å¤‰é©ã‚„æ”¹å–„ã®å–ã‚Šçµ„ã¿ã‚’ä¿¡é ¼ã§ãã‚‹",
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼8: åƒãç’°å¢ƒ (Q71-80)
    "ã‚ªãƒ•ã‚£ã‚¹ã®è¨­å‚™ã‚„ç’°å¢ƒã¯å¿«é©ã§ã‚ã‚‹",
    "æ¥­å‹™ã«å¿…è¦ãªè¨­å‚™ã‚„ãƒ„ãƒ¼ãƒ«ãŒæƒã£ã¦ã„ã‚‹",
    "å®‰å…¨ã§è¡›ç”Ÿçš„ãªè·å ´ç’°å¢ƒã§ã‚ã‚‹",
    "åœ¨å®…å‹¤å‹™ãªã©æŸ”è»Ÿãªåƒãæ–¹ãŒã§ãã¦ã„ã‚‹",
    "æ¥­å‹™ã«é›†ä¸­ã§ãã‚‹ç’°å¢ƒãŒæ•´ã£ã¦ã„ã‚‹",
    "æ¥­å‹™ã«å¿…è¦ãªæƒ…å ±ã‚„ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚„ã™ã„",
    "æ¥­å‹™ã§ä½¿ç”¨ã™ã‚‹ITã‚·ã‚¹ãƒ†ãƒ ã‚„ãƒ„ãƒ¼ãƒ«ã¯ä½¿ã„ã‚„ã™ã„",
    "ç¤¾å†…ã®æ‰‹ç¶šãã¯åˆ†ã‹ã‚Šã‚„ã™ãåŠ¹ç‡çš„ã§ã‚ã‚‹",
    "ä¼šè­°ã¯ç›®çš„ãŒæ˜ç¢ºã§åŠ¹ç‡çš„ã«é€²ã‚ã‚‰ã‚Œã¦ã„ã‚‹",
    "è‚²å…ã‚„ä»‹è­·ãªã©ã€ãƒ©ã‚¤ãƒ•ã‚¤ãƒ™ãƒ³ãƒˆã«é…æ…®ã—ãŸæ”¯æ´åˆ¶åº¦ãŒã‚ã‚‹",
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼9: ç·åˆæº€è¶³åº¦ (Q81-90)
    "ä»Šã®ä¼šç¤¾ã§åƒãã“ã¨ã«æº€è¶³ã—ã¦ã„ã‚‹",
    "ä»•äº‹ã«å–ã‚Šçµ„ã‚€æ™‚ã«å‰å‘ããªæ°—æŒã¡ã‚’æŒã¦ã¦ã„ã‚‹",
    "ä»Šã®è·å ´ç’°å¢ƒã¯ã€è‡ªåˆ†ã®åƒãã‚„ã™ã•ã«é…æ…®ã•ã‚Œã¦ã„ã‚‹",
    "ä»Šã®æ¥­å‹™é‡ã¯é©åˆ‡ã ã¨æ€ã†",
    "ä¼šç¤¾ã®å°†æ¥æ€§ã«æœŸå¾…ã‚’æŒã¦ã¦ã„ã‚‹",
    "è‡ªåˆ†ã®èƒ½åŠ›ã‚’ååˆ†ã«ç™ºæ®ã§ãã¦ã„ã‚‹",
    "ä»Šå¾Œã®ã‚­ãƒ£ãƒªã‚¢å½¢æˆã«æœŸå¾…ã§ãã¦ã„ã‚‹",
    "å‹¤å‹™æ™‚é–“ã¯å¦¥å½“ãªç¯„å›²ã«åã¾ã£ã¦ã„ã‚‹",
    "æ¥­å‹™ã®è²¬ä»»ç¯„å›²ãŒæ˜ç¢ºã«ãªã£ã¦ã„ã‚‹",
    "éåº¦ãªãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ã‚’æ„Ÿã˜ã‚‹ã“ã¨ãªãåƒã‘ã¦ã„ã‚‹",
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼10: çµ„ç¹”ã¸ã®ã¤ãªãŒã‚Š (Q91-100)
    "ã“ã®ä¼šç¤¾ã®åƒãæ–¹ã¯è‡ªåˆ†ã«åˆã£ã¦ã„ã‚‹",
    "ã“ã®ä¼šç¤¾ã§è‡ªåˆ†ã®å±…å ´æ‰€ã‚’æŒã¦ã¦ã„ã‚‹",
    "ã“ã®ä¼šç¤¾ã®æ–‡åŒ–ã‚„ä¾¡å€¤è¦³ã«å…±æ„Ÿã—ã¦ã„ã‚‹",
    "ã“ã®ä¼šç¤¾ã§åƒãã“ã¨ã‚’å®¶æ—ã‚„å‹äººã«å‰å‘ãã«è©±ã—ã¦ã„ã‚‹",
    "ã“ã®ä¼šç¤¾ã§åƒãã“ã¨ã«å®‰å¿ƒæ„Ÿã‚’æŒã¦ã¦ã„ã‚‹",
    "ã“ã®ä¼šç¤¾ã¯ã“ã‚Œã‹ã‚‰ã‚‚å­˜ç¶šã—ã¦ã„ãã¨æ€ãˆã‚‹",
    "ã“ã®ä¼šç¤¾ã®ä¸€å“¡ã§ã‚ã‚‹ã“ã¨ã«èª‡ã‚Šã‚’æŒã£ã¦ã„ã‚‹",
    "ã“ã®ä¼šç¤¾ã‚’å…¥ç¤¾å‰ã®è‡ªåˆ†ã«å‹§ã‚ãŸã„ã¨æ€ã†",
    "ã“ã®ä¼šç¤¾ã§ã¯è‡ªåˆ†ã®å€‹æ€§ã‚’æ´»ã‹ã—ã¦åƒã‘ã‚‹",
    "ã“ã®ä¼šç¤¾ã§é•·ãåƒãç¶šã‘ãŸã„ã¨æ€ã†"
];

// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
let currentSection = 0; // ç¾åœ¨ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ (0-9)
let answers = {}; // {questionIndex: score} ã®å½¢å¼ã§ä¿å­˜
let employeeCode = '';
let department = '';
let gender = '';
let companyName = ''; // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰å–å¾—ã™ã‚‹ä¼šç¤¾å

// URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ä¼šç¤¾åã‚’å–å¾—
function getCompanyFromURL() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('company') || 'æœªè¨­å®š';
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¼šç¤¾åã‚’å–å¾—
window.addEventListener('DOMContentLoaded', function() {
    companyName = getCompanyFromURL();
    console.log('ä¼šç¤¾å:', companyName);
});

// ãƒšãƒ¼ã‚¸é·ç§»é–¢æ•°
function showPage(pageId) {
    document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
    });
    document.getElementById(pageId).classList.add('active');
    window.scrollTo(0, 0);
}

// åŸºæœ¬æƒ…å ±ã®ä¿å­˜ã¨è¨ºæ–­é–‹å§‹
function saveDepartmentAndStart() {
    employeeCode = document.getElementById('employee-code').value.trim();
    department = document.getElementById('department').value;
    gender = document.getElementById('gender').value;
    
    if (!employeeCode || !department || !gender) {
        alert('å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }
    
    showPage('survey-page');
    loadSection(0);
}

// ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿ (10å•ãšã¤è¡¨ç¤º)
function loadSection(sectionIndex) {
    currentSection = sectionIndex;
    const startQ = sectionIndex * 10;
    const endQ = startQ + 10;
    
    const container = document.getElementById('questions-container');
    container.innerHTML = '';
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æ›´æ–°
    const categoryHeader = document.querySelector('#category-header-fixed h2');
    categoryHeader.textContent = `ã‚«ãƒ†ã‚´ãƒªãƒ¼${sectionIndex + 1}: ${categories[sectionIndex]}`;
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼5 (Q41-50) ã®æ³¨é‡ˆè¡¨ç¤º
    let categoryNote = document.querySelector('.category-note');
    if (categoryNote) categoryNote.remove();
    
    if (sectionIndex === 4) { // ã‚«ãƒ†ã‚´ãƒªãƒ¼5
        const noteDiv = document.createElement('div');
        noteDiv.className = 'category-note';
        noteDiv.innerHTML = '<p>â€»ä»¥ä¸‹ã®è¨­å•ã«ãŠã‘ã‚‹ã€Œè‡ªéƒ¨ç½²ã€ã¨ã¯ã€ã‚ãªãŸãŒæ™®æ®µä¸€ç·’ã«ä»•äº‹ã‚’ã—ã¦ã„ã‚‹ãƒ¡ãƒ³ãƒãƒ¼(ãƒãƒ¼ãƒ ãƒ»éƒ¨ç½²)ã‚’æŒ‡ã—ã¾ã™ã€‚</p>';
        container.before(noteDiv);
    }
    
    // å„è³ªå•ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    for (let i = startQ; i < endQ; i++) {
        const questionBlock = document.createElement('div');
        questionBlock.className = 'question-block';
        questionBlock.id = `question-${i}`;
        
        const questionNum = i + 1;
        const questionText = document.createElement('div');
        questionText.className = 'question-text';
        questionText.textContent = `Q${questionNum}. ${questions[i]}`;
        
        const answerOptions = document.createElement('div');
        answerOptions.className = 'answer-options';
        
        for (let score = 1; score <= 5; score++) {
            const label = document.createElement('label');
            label.className = 'answer-option';
            
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = `question${i}`;
            input.value = score;
            if (answers[i] === score) {
                input.checked = true;
            }
            input.addEventListener('change', () => {
                answers[i] = parseInt(score);
                updateProgressBar();
                autoScrollToNext(i);
            });
            
            const span = document.createElement('span');
            span.textContent = `${score}`;
            
            label.appendChild(input);
            label.appendChild(span);
            answerOptions.appendChild(label);
        }
        
        questionBlock.appendChild(questionText);
        questionBlock.appendChild(answerOptions);
        container.appendChild(questionBlock);
    }
    
    // é€²æ—ãƒãƒ¼ã®æ›´æ–°
    updateProgressBar();
    
    // ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
    document.getElementById('prev-btn').style.display = sectionIndex > 0 ? 'inline-block' : 'none';
    document.getElementById('next-btn').textContent = sectionIndex < 9 ? 'æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³' : 'çµæœã‚’è¦‹ã‚‹';
    
    // ãƒšãƒ¼ã‚¸ãƒˆãƒƒãƒ—ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
    window.scrollTo(0, 0);
}

// è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ©Ÿèƒ½
function autoScrollToNext(currentQuestionIndex) {
    const startQ = currentSection * 10;
    const endQ = startQ + 10;
    const nextQuestionIndex = currentQuestionIndex + 1;
    
    // ç¾åœ¨ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã«æ¬¡ã®è³ªå•ãŒã‚ã‚‹å ´åˆ
    if (nextQuestionIndex < endQ) {
        setTimeout(() => {
            const nextQuestion = document.getElementById(`question-${nextQuestionIndex}`);
            if (nextQuestion) {
                const headerHeight = 230; // å›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼ã®é«˜ã•
                const elementPosition = nextQuestion.getBoundingClientRect().top + window.pageYOffset;
                const offsetPosition = elementPosition - headerHeight - 20; // 20pxã®ä½™ç™½
                
                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            }
        }, 300);
    }
}

// é€²æ—ãƒãƒ¼ã®æ›´æ–°
function updateProgressBar() {
    const answeredCount = Object.keys(answers).length;
    const progressPercentage = Math.round((answeredCount / 100) * 100);
    document.getElementById('progress-fill').style.width = progressPercentage + '%';
    document.getElementById('progress-percentage').textContent = progressPercentage + '%';
}

// æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³
function nextSection() {
    // ç¾åœ¨ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å›ç­”ãƒã‚§ãƒƒã‚¯
    const startQ = currentSection * 10;
    const endQ = startQ + 10;
    
    for (let i = startQ; i < endQ; i++) {
        if (!answers[i]) {
            alert('å…¨ã¦ã®è³ªå•ã«å›ç­”ã—ã¦ãã ã•ã„');
            return;
        }
    }
    
    if (currentSection < 9) {
        loadSection(currentSection + 1);
    } else {
        showResult();
    }
}

// å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³
function previousSection() {
    if (currentSection > 0) {
        loadSection(currentSection - 1);
    }
}

// çµæœã®è¡¨ç¤º
function showResult() {
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã‚¹ã‚³ã‚¢ã®è¨ˆç®— (50ç‚¹æº€ç‚¹ã®ã¾ã¾ä¿å­˜)
    const categoryScores = [];
    for (let i = 0; i < 10; i++) {
        const startQ = i * 10 + 1;  // Q1ã‹ã‚‰é–‹å§‹ (i=0 â†’ Q1-Q10)
        const endQ = startQ + 10;
        let sum = 0;
        for (let j = startQ; j < endQ; j++) {
            sum += answers[j] || 0;  // undefinedå¯¾ç­–
        }
        categoryScores.push(sum);  // 50ç‚¹æº€ç‚¹ã®ã¾ã¾ä¿å­˜
    }
    
    // ç·åˆã‚¹ã‚³ã‚¢ã®è¨ˆç®— (500ç‚¹æº€ç‚¹)
    const totalScore = Object.values(answers).reduce((a, b) => a + b, 0);
    
    showPage('result-page');
    
    // 500ç‚¹æº€ç‚¹ã‚’100ç‚¹æº€ç‚¹ã«å¤‰æ›ã—ã¦è¡¨ç¤º
    const totalScoreDisplay = Math.round((totalScore / 500) * 100);
    document.getElementById('total-score').textContent = totalScoreDisplay;
    
    // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®æç”»
    drawRadarChart(categoryScores);
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥çµæœã®è¡¨ç¤º
    displayCategoryResults(categoryScores);
    
    // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®è¡¨ç¤º
    displayFeedback(categoryScores);
    
    // APIé€ä¿¡
    submitResults(totalScore, categoryScores);
}

// ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®æç”»
function drawRadarChart(scores) {
    const ctx = document.getElementById('radarChart');
    new Chart(ctx, {
        type: 'radar',
        data: {
            labels: categories,
            datasets: [{
                label: 'ã‚ãªãŸã®ã‚¹ã‚³ã‚¢',
                data: scores.map(s => Math.round((s / 50) * 100)),  // 50ç‚¹æº€ç‚¹ã‚’100ç‚¹æº€ç‚¹ã«å¤‰æ›ã—ã¦è¡¨ç¤º
                backgroundColor: 'rgba(93, 173, 226, 0.2)',
                borderColor: 'rgba(93, 173, 226, 1)',
                pointBackgroundColor: 'rgba(93, 173, 226, 1)',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgba(93, 173, 226, 1)'
            }]
        },
        options: {
            scales: {
                r: {
                    beginAtZero: true,
                    max: 100,
                    ticks: { stepSize: 20 }
                }
            }
        }
    });
}

// ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥çµæœã®è¡¨ç¤º
function displayCategoryResults(scores) {
    // 50ç‚¹æº€ç‚¹ã‚’100ç‚¹æº€ç‚¹ã«å¤‰æ›
    const scoresDisplay = scores.map(s => Math.round((s / 50) * 100));
    const container = document.getElementById('category-results');
    container.innerHTML = '<h2>ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã‚¹ã‚³ã‚¢</h2>';
    
    scoresDisplay.forEach((score, index) => {
        const item = document.createElement('div');
        item.className = 'category-score-item';
        item.innerHTML = `
            <h3>${categories[index]}</h3>
            <div class="score-bar">
                <div class="score-fill" style="width: ${score}%"></div>
            </div>
            <p>${score} / 100ç‚¹</p>
        `;
        container.appendChild(item);
    });
}

// ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®è¡¨ç¤º
function displayFeedback(scores) {
    const container = document.getElementById('feedback-section');
    container.innerHTML = '<h2>ğŸ“‹ ã‚ãªãŸã¸ã®æ”¹å–„ææ¡ˆ</h2>';
    
    // 50ç‚¹æº€ç‚¹ã‚’100ç‚¹æº€ç‚¹ã«å¤‰æ›
    const scoresDisplay = scores.map(s => Math.round((s / 50) * 100));
    
    // ã‚¹ã‚³ã‚¢ã®ä½ã„é †ã«3ã¤å–å¾—
    const sortedCategories = scoresDisplay.map((score, index) => ({score, index}))
        .sort((a, b) => a.score - b.score)
        .slice(0, 3);
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã®å…·ä½“çš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    const feedbackMessages = {
        0: { // å¿ƒèº«ã®å¥åº·
            high: "å¿ƒèº«ã®å¥åº·çŠ¶æ…‹ã¯è‰¯å¥½ã§ã™ã€‚ã“ã®ãƒãƒ©ãƒ³ã‚¹ã‚’ç¶­æŒã—ãªãŒã‚‰ã€ã•ã‚‰ã«å¥åº·çš„ãªåƒãæ–¹ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚",
            medium: "ã‚¹ãƒˆãƒ¬ã‚¹ç®¡ç†ã‚„ä¼‘æš‡å–å¾—ã«ã¤ã„ã¦ã€ã‚‚ã†å°‘ã—æ„è­˜çš„ã«å–ã‚Šçµ„ã‚€ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚ä¸Šå¸ã«ç›¸è«‡ã—ã‚„ã™ã„ç’°å¢ƒã¥ãã‚Šã‚‚æ¤œè¨ã—ã¦ã¿ã¦ãã ã•ã„ã€‚",
            low: "å¿ƒèº«ã®å¥åº·ã«é»„è‰²ä¿¡å·ãŒå‡ºã¦ã„ã¾ã™ã€‚ã¾ãšã¯ã€ä¿¡é ¼ã§ãã‚‹ä¸Šå¸ã‚„äººäº‹éƒ¨é–€ã«ç›¸è«‡ã™ã‚‹ã“ã¨ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚å¿…è¦ã«å¿œã˜ã¦ä¼‘æš‡å–å¾—ã‚„æ¥­å‹™é‡ã®èª¿æ•´ã‚’æ¤œè¨ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚"
        },
        1: { // ä»•äº‹ã®å……å®Ÿæ„Ÿ
            high: "ä»•äº‹ã«å¯¾ã—ã¦é«˜ã„ã‚„ã‚ŠãŒã„ã‚’æ„Ÿã˜ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®çŠ¶æ…‹ã‚’ç¶­æŒã—ãªãŒã‚‰ã€ã•ã‚‰ãªã‚‹æˆé•·ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚",
            medium: "ä»•äº‹ã®æ„ç¾©ã‚„è‡ªåˆ†ã®è²¢çŒ®ã‚’ã‚‚ã†å°‘ã—å®Ÿæ„Ÿã§ãã‚‹ã‚ˆã†ã€ä¸Šå¸ã¨ç›®æ¨™è¨­å®šã«ã¤ã„ã¦è©±ã—åˆã£ã¦ã¿ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚",
            low: "ä»•äº‹ã®å……å®Ÿæ„ŸãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚ã‚ãªãŸã®å¼·ã¿ã‚’æ´»ã‹ã›ã‚‹æ¥­å‹™ã‚„ã€èˆˆå‘³ã®ã‚ã‚‹åˆ†é‡ã¸ã®æŒ‘æˆ¦ã«ã¤ã„ã¦ã€ä¸Šå¸ã¨ç›¸è«‡ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚è‡ªåˆ†ã®ä»•äº‹ãŒçµ„ç¹”ã«ã©ã†è²¢çŒ®ã—ã¦ã„ã‚‹ã‹ã€å®šæœŸçš„ã«ç¢ºèªã™ã‚‹ã“ã¨ã‚‚å¤§åˆ‡ã§ã™ã€‚"
        },
        2: { // æˆé•·æ©Ÿä¼š
            high: "æˆé•·æ©Ÿä¼šã«æµã¾ã‚ŒãŸç’°å¢ƒã«ã„ã¾ã™ã€‚ç©æ¥µçš„ã«å­¦ç¿’ã‚„ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã«å–ã‚Šçµ„ã¿ã€ã‚­ãƒ£ãƒªã‚¢ã‚’åºƒã’ã¦ã„ãã¾ã—ã‚‡ã†ã€‚",
            medium: "æˆé•·æ©Ÿä¼šã‚’ã‚‚ã†å°‘ã—å¢—ã‚„ã›ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚å¿…è¦ãªç ”ä¿®ã‚„è³‡æ ¼å–å¾—ã«ã¤ã„ã¦ã€ä¸Šå¸ã‚„äººäº‹éƒ¨é–€ã«ç›¸è«‡ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚",
            low: "æˆé•·æ©Ÿä¼šãŒä¸è¶³ã—ã¦ã„ã‚‹ã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚è‡ªåˆ†ã®ã‚­ãƒ£ãƒªã‚¢ãƒ—ãƒ©ãƒ³ã‚’æ˜ç¢ºã«ã—ã€å¿…è¦ãªå­¦ç¿’ã‚„ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã®æ©Ÿä¼šã«ã¤ã„ã¦ã€ä¸Šå¸ã¨å…·ä½“çš„ã«è©±ã—åˆã†ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚ç¤¾å†…å¤–ã®ç ”ä¿®åˆ¶åº¦ã‚‚ç©æ¥µçš„ã«æ´»ç”¨ã—ã¾ã—ã‚‡ã†ã€‚"
        },
        3: { // ä¸Šå¸ã®ã‚µãƒãƒ¼ãƒˆ
            high: "ä¸Šå¸ã‹ã‚‰ã®é©åˆ‡ãªã‚µãƒãƒ¼ãƒˆã‚’å¾—ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®è‰¯å¥½ãªé–¢ä¿‚ã‚’ç¶­æŒã—ã€ã•ã‚‰ã«æˆé•·ã«ã¤ãªã’ã¦ã„ãã¾ã—ã‚‡ã†ã€‚",
            medium: "ä¸Šå¸ã¨ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¢—ã‚„ã™ã“ã¨ã§ã€ã‚ˆã‚Šè‰¯ã„ã‚µãƒãƒ¼ãƒˆãŒå¾—ã‚‰ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚å®šæœŸçš„ãª1on1ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ææ¡ˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚",
            low: "ä¸Šå¸ã‹ã‚‰ã®ã‚µãƒãƒ¼ãƒˆãŒä¸è¶³ã—ã¦ã„ã‚‹ã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚ã¾ãšã¯ã€å…·ä½“çš„ã«ã©ã®ã‚ˆã†ãªã‚µãƒãƒ¼ãƒˆãŒå¿…è¦ã‹æ•´ç†ã—ã€ä¸Šå¸ã«ç‡ç›´ã«ä¼ãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚ãã‚Œã§ã‚‚æ”¹å–„ã—ãªã„å ´åˆã¯ã€äººäº‹éƒ¨é–€ã«ç›¸è«‡ã™ã‚‹ã“ã¨ã‚‚æ¤œè¨ã—ã¦ãã ã•ã„ã€‚"
        },
        4: { // éƒ¨ç½²å†…ã®äººé–“é–¢ä¿‚
            high: "éƒ¨ç½²å†…ã®äººé–“é–¢ä¿‚ã¯è‰¯å¥½ã§ã™ã€‚ã“ã®å”åŠ›çš„ãªé›°å›²æ°—ã‚’å¤§åˆ‡ã«ã—ã€ãƒãƒ¼ãƒ å…¨ä½“ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã«è²¢çŒ®ã—ã¾ã—ã‚‡ã†ã€‚",
            medium: "éƒ¨ç½²å†…ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚‚ã†å°‘ã—æ´»æ€§åŒ–ã•ã›ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šè‰¯ã„ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒç”Ÿã¾ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            low: "éƒ¨ç½²å†…ã®äººé–“é–¢ä¿‚ã«èª²é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ã¾ãšã¯ã€ä¿¡é ¼ã§ãã‚‹åŒåƒšã¨ã®é–¢ä¿‚ã‚’æ·±ã‚ã‚‹ã“ã¨ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚å¿…è¦ã«å¿œã˜ã¦ã€ä¸Šå¸ã‚„äººäº‹éƒ¨é–€ã«ç›¸è«‡ã—ã€ãƒãƒ¼ãƒ å…¨ä½“ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ”¹å–„ã‚’ææ¡ˆã™ã‚‹ã“ã¨ã‚‚æœ‰åŠ¹ã§ã™ã€‚"
        },
        5: { // è©•ä¾¡ãƒ»å‡¦é‡
            high: "è©•ä¾¡ã‚„å‡¦é‡ã«ç´å¾—ã§ãã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚å¼•ãç¶šãæˆæœã‚’å‡ºã—ãªãŒã‚‰ã€ã•ã‚‰ãªã‚‹ã‚­ãƒ£ãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚",
            medium: "è©•ä¾¡åŸºæº–ã‚„å‡¦é‡ã«ã¤ã„ã¦ã€ã‚‚ã†å°‘ã—æ˜ç¢ºã«ç†è§£ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚è©•ä¾¡é¢è«‡ã§å…·ä½“çš„ãªè³ªå•ã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚",
            low: "è©•ä¾¡ã‚„å‡¦é‡ã«ä¸æº€ã‚’æ„Ÿã˜ã¦ã„ã¾ã™ã€‚ã¾ãšã¯è©•ä¾¡åŸºæº–ã‚’æ˜ç¢ºã«ç†è§£ã—ã€è‡ªåˆ†ã®è²¢çŒ®ãŒã©ã†è©•ä¾¡ã•ã‚Œã¦ã„ã‚‹ã‹ã€ä¸Šå¸ã¨ç‡ç›´ã«è©±ã—åˆã„ã¾ã—ã‚‡ã†ã€‚å¿…è¦ã«å¿œã˜ã¦äººäº‹éƒ¨é–€ã«ã‚‚ç›¸è«‡ã—ã¦ãã ã•ã„ã€‚"
        },
        6: { // ä¼šç¤¾ã¸ã®ä¿¡é ¼
            high: "ä¼šç¤¾ã¸ã®ä¿¡é ¼æ„ŸãŒé«˜ã„çŠ¶æ…‹ã§ã™ã€‚ã“ã®å‰å‘ããªå§¿å‹¢ã‚’ç¶­æŒã—ã€çµ„ç¹”ã®ç™ºå±•ã«è²¢çŒ®ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚",
            medium: "ä¼šç¤¾ã®æ–¹é‡ã‚„æˆ¦ç•¥ã«ã¤ã„ã¦ã€ã‚‚ã†å°‘ã—ç†è§£ã‚’æ·±ã‚ã‚‹ã“ã¨ã§ã€ä¿¡é ¼æ„ŸãŒå¢—ã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            low: "ä¼šç¤¾ã¸ã®ä¿¡é ¼ã«èª²é¡ŒãŒã‚ã‚Šã¾ã™ã€‚çµŒå–¶å±¤ã‹ã‚‰ã®æƒ…å ±å…±æœ‰ã‚„ã€ä¼šç¤¾ã®æ–¹å‘æ€§ã«ã¤ã„ã¦ç†è§£ã‚’æ·±ã‚ã‚‹æ©Ÿä¼šã‚’æ±‚ã‚ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä¸æ˜ç‚¹ãŒã‚ã‚Œã°ã€ä¸Šå¸ã‚„äººäº‹éƒ¨é–€ã«è³ªå•ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚"
        },
        7: { // åƒãç’°å¢ƒ
            high: "åƒãç’°å¢ƒã«æº€è¶³ã§ãã¦ã„ã¾ã™ã€‚ã“ã®ç’°å¢ƒã‚’æ´»ã‹ã—ã¦ã€ã•ã‚‰ã«ç”Ÿç”£æ€§ã‚’é«˜ã‚ã¦ã„ãã¾ã—ã‚‡ã†ã€‚",
            medium: "åƒãç’°å¢ƒã«ã¤ã„ã¦æ”¹å–„ã§ãã‚‹ç‚¹ãŒã‚ã‚Šãã†ã§ã™ã€‚å…·ä½“çš„ãªè¦æœ›ã‚’æ•´ç†ã—ã€ä¸Šå¸ã‚„æ‹…å½“éƒ¨ç½²ã«ææ¡ˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚",
            low: "åƒãç’°å¢ƒã«ä¸æº€ãŒã‚ã‚Šã¾ã™ã€‚è¨­å‚™ã€ãƒ„ãƒ¼ãƒ«ã€åˆ¶åº¦ãªã©ã€å…·ä½“çš„ãªæ”¹å–„ç‚¹ã‚’æ•´ç†ã—ã€ä¸Šå¸ã‚„ç·å‹™éƒ¨é–€ã«ç›¸è«‡ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚æŸ”è»Ÿãªåƒãæ–¹ã®å°å…¥ã«ã¤ã„ã¦ã‚‚æ¤œè¨ã‚’ä¾é ¼ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚"
        },
        8: { // ç·åˆæº€è¶³åº¦
            high: "è·å ´å…¨ä½“ã«é«˜ã„æº€è¶³åº¦ã‚’æ„Ÿã˜ã¦ã„ã¾ã™ã€‚ã“ã®çŠ¶æ…‹ã‚’ç¶­æŒã—ãªãŒã‚‰ã€ã•ã‚‰ãªã‚‹æˆé•·ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚",
            medium: "æº€è¶³åº¦ã‚’é«˜ã‚ã‚‹ãŸã‚ã«ã€å„ªå…ˆçš„ã«æ”¹å–„ã—ãŸã„ç‚¹ã‚’æ˜ç¢ºã«ã—ã€ä¸Šå¸ã¨ç›¸è«‡ã—ã¦ã¿ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚",
            low: "ç·åˆçš„ãªæº€è¶³åº¦ãŒä½ã„çŠ¶æ…‹ã§ã™ã€‚ã¾ãšã¯æœ€ã‚‚æ”¹å–„ã—ãŸã„ç‚¹ã‚’1ã¤ã«çµã‚Šã€ä¸Šå¸ã‚„äººäº‹éƒ¨é–€ã¨å…·ä½“çš„ãªæ”¹å–„ç­–ã‚’è©±ã—åˆã„ã¾ã—ã‚‡ã†ã€‚å°ã•ãªæ”¹å–„ã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚"
        },
        9: { // çµ„ç¹”ã¸ã®ã¤ãªãŒã‚Š
            high: "çµ„ç¹”ã¸ã®å¼·ã„ã¤ãªãŒã‚Šã‚’æ„Ÿã˜ã¦ã„ã¾ã™ã€‚ã“ã®å¸°å±æ„è­˜ã‚’å¤§åˆ‡ã«ã—ã€é•·æœŸçš„ãªã‚­ãƒ£ãƒªã‚¢ã‚’ç¯‰ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚",
            medium: "çµ„ç¹”ã¨ã®ã¤ãªãŒã‚Šã‚’ã‚‚ã†å°‘ã—å¼·åŒ–ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ä¼šç¤¾ã®ä¾¡å€¤è¦³ã‚„æ–‡åŒ–ã«ã¤ã„ã¦ç†è§£ã‚’æ·±ã‚ã¦ã¿ã¾ã—ã‚‡ã†ã€‚",
            low: "çµ„ç¹”ã¸ã®ã¤ãªãŒã‚ŠãŒå¼±ã„ã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚ä¼šç¤¾ã®æ–‡åŒ–ã‚„ä¾¡å€¤è¦³ã«ã¤ã„ã¦æ”¹ã‚ã¦ç†è§£ã‚’æ·±ã‚ã€è‡ªåˆ†ã®ä¾¡å€¤è¦³ã¨ã®ãƒ•ã‚£ãƒƒãƒˆæ„Ÿã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚å¿…è¦ã«å¿œã˜ã¦ã€ã‚­ãƒ£ãƒªã‚¢ãƒ—ãƒ©ãƒ³ã«ã¤ã„ã¦ä¸Šå¸ã¨è©±ã—åˆã†ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚"
        }
    };
    
    sortedCategories.forEach(({score, index}) => {
        let level, levelClass, message;
        
        if (score >= 70) {
            level = 'è‰¯å¥½';
            levelClass = 'feedback-good';
            message = feedbackMessages[index].high;
        } else if (score >= 50) {
            level = 'æ”¹å–„ã®ä½™åœ°ã‚ã‚Š';
            levelClass = 'feedback-normal';
            message = feedbackMessages[index].medium;
        } else {
            level = 'è¦æ”¹å–„';
            levelClass = 'feedback-warning';
            message = feedbackMessages[index].low;
        }
        
        const item = document.createElement('div');
        item.className = 'feedback-item';
        item.innerHTML = `
            <h3 class="${levelClass}">ğŸ“Œ ${categories[index]}(${score}ç‚¹)- ${level}</h3>
            <p class="feedback-message">${message}</p>
        `;
        container.appendChild(item);
    });
    
    // å…¨ä½“çš„ãªã¾ã¨ã‚ã‚³ãƒ¡ãƒ³ãƒˆ
    const avgScore = Math.round(scoresDisplay.reduce((a, b) => a + b, 0) / scoresDisplay.length);
    let summaryMessage = '';
    
    if (avgScore >= 70) {
        summaryMessage = 'âœ¨ å…¨ä½“çš„ã«é«˜ã„ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã‚’ä¿ã¦ã¦ã„ã¾ã™ã€‚ã“ã®çŠ¶æ…‹ã‚’ç¶­æŒã—ãªãŒã‚‰ã€ã•ã‚‰ãªã‚‹æˆé•·ã¨ã‚­ãƒ£ãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚';
    } else if (avgScore >= 50) {
        summaryMessage = 'ğŸ’¡ æ”¹å–„ã§ãã‚‹é ˜åŸŸãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚ä¸Šè¨˜ã®ææ¡ˆã‚’å‚è€ƒã«ã€å„ªå…ˆé †ä½ã‚’ã¤ã‘ã¦ä¸€ã¤ãšã¤å–ã‚Šçµ„ã‚“ã§ã„ãã¾ã—ã‚‡ã†ã€‚';
    } else {
        summaryMessage = 'âš ï¸ è¤‡æ•°ã®é ˜åŸŸã§æ”¹å–„ãŒå¿…è¦ãªçŠ¶æ…‹ã§ã™ã€‚ã¾ãšã¯æœ€ã‚‚é‡è¦ã ã¨æ„Ÿã˜ã‚‹1ã¤ã®é …ç›®ã«é›†ä¸­ã—ã€ä¸Šå¸ã‚„äººäº‹éƒ¨é–€ã¨ç›¸è«‡ã—ãªãŒã‚‰å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ã‚’ç«‹ã¦ã¾ã—ã‚‡ã†ã€‚';
    }
    
    const summaryDiv = document.createElement('div');
    summaryDiv.className = 'feedback-summary';
    summaryDiv.innerHTML = `
        <h3>ğŸ’¬ ç·åˆã‚³ãƒ¡ãƒ³ãƒˆ</h3>
        <p>${summaryMessage}</p>
        <p style="margin-top: 15px; color: #666;">ã“ã®è¨ºæ–­çµæœã¯ã€ã‚ãªãŸã®æˆé•·ã¨ã‚­ãƒ£ãƒªã‚¢é–‹ç™ºã®ãŸã‚ã®å‚è€ƒæƒ…å ±ã§ã™ã€‚å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯ã€ä¸Šå¸ã‚„äººäº‹éƒ¨é–€ã¨ç›¸è«‡ã—ãªãŒã‚‰é€²ã‚ã¦ã„ãã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚</p>
    `;
    container.appendChild(summaryDiv);
}

// APIã«çµæœã‚’é€ä¿¡
function submitResults(totalScore, categoryScores) {
    const categoryScoresObj = {};
    categories.forEach((cat, index) => {
        categoryScoresObj[cat] = categoryScores[index];
    });
    
    const data = {
        company: companyName,
        employeeCode: employeeCode,
        department: department,
        gender: gender,
        timestamp: new Date().toISOString(),
        totalScore: totalScore,
        categoryScores: categoryScoresObj,
        answers: answers
    };
    
    fetch(`${API_ENDPOINT}/api/diagnostics`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => console.log('è¨ºæ–­çµæœã‚’é€ä¿¡ã—ã¾ã—ãŸ:', result))
    .catch(error => console.error('é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error));
}
